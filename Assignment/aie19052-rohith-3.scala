val BD = sc.textFile("weblogsample.csv") 
val header = BD.first()
val log_rdd = BD.filter(row => row != header)
val weblog_rdd = log_rdd.map {l =>
     val s = l.split(',')
     val (ip,date,time,zone,cik,accession,extention,code,size,idx,norefer,noagent,find,crawler) = (s(0),s(1),s(2),s(3),s(4),s(5),s(6),s(7),s(8),s(9),s(10),s(11),s(12),s(13))
     (ip,date,time,zone,cik,accession,extention,code,size,idx,norefer,noagent,find,crawler)
      }

weblog_rdd.toDF("ip", "date", "time", "zone", "cik", "accession", "extention", "code", "size", "idx", "norefer", "noagent", "find", "crawler").show()
/*
weblog_rdd: org.apache.spark.rdd.RDD[(String, String, String, String, String, String, String, String, String, String, String, String, String, String)] = MapPartitionsRDD[807] at map at Q3.scala:27
+---------------+----------+--------+----+---------+--------------------+---------------+-----+--------+---+-------+-------+----+-------+
|             ip|      date|    time|zone|      cik|           accession|      extention| code|    size|idx|norefer|noagent|find|crawler|
+---------------+----------+--------+----+---------+--------------------+---------------+-----+--------+---+-------+-------+----+-------+
|  101.81.76.dii|2016-03-31|00:00:00| 0.0|1283497.0|0001209191-16-111028|     -index.htm|200.0| 14926.0|1.0|    0.0|    0.0|10.0|    0.0|
| 104.40.128.jig|2016-03-31|00:00:00| 0.0|1094392.0|0001407682-16-000270|           .txt|200.0|  5161.0|0.0|    0.0|    0.0|10.0|    0.0|
| 104.40.128.jig|2016-03-31|00:00:00| 0.0| 278130.0|0001183887-16-000354|           .txt|200.0|  5105.0|0.0|    0.0|    0.0|10.0|    0.0|
| 104.40.128.jig|2016-03-31|00:00:00| 0.0|1389680.0|0001407682-16-000270|           .txt|301.0|   237.0|0.0|    0.0|    1.0|10.0|    0.0|
| 104.40.128.jig|2016-03-31|00:00:00| 0.0|1439019.0|0001183887-16-000354|           .txt|301.0|   237.0|0.0|    0.0|    1.0|10.0|    0.0|
| 104.40.128.jig|2016-03-31|00:00:00| 0.0|1094392.0|0001407682-16-000270|           .txt|301.0|   237.0|0.0|    0.0|    1.0|10.0|    0.0|
| 104.40.128.jig|2016-03-31|00:00:00| 0.0|1389680.0|0001407682-16-000270|           .txt|200.0|  5161.0|0.0|    0.0|    0.0|10.0|    0.0|
| 104.40.128.jig|2016-03-31|00:00:00| 0.0|1439019.0|0001183887-16-000354|           .txt|200.0|  5105.0|0.0|    0.0|    0.0|10.0|    0.0|
| 104.40.128.jig|2016-03-31|00:00:00| 0.0| 278130.0|0001183887-16-000354|           .txt|301.0|   236.0|0.0|    0.0|    1.0|10.0|    0.0|
|107.178.195.cej|2016-03-31|00:00:00| 0.0|1402737.0|0001594062-16-000417|      -xbrl.zip|200.0|155422.0|0.0|    0.0|    0.0|10.0|    0.0|
|107.178.195.cej|2016-03-31|00:00:00| 0.0|1063104.0|0001019687-16-005675|      -xbrl.zip|200.0| 51009.0|0.0|    0.0|    0.0|10.0|    0.0|
|107.178.195.fgg|2016-03-31|00:00:00| 0.0|1174672.0|0000721748-16-001126|      -xbrl.zip|200.0| 75571.0|0.0|    0.0|    0.0|10.0|    0.0|
| 121.200.54.aah|2016-03-31|00:00:00| 0.0|1372514.0|0001144204-16-091485|v434534_10k.htm|200.0|137569.0|0.0|    0.0|    0.0|10.0|    0.0|
| 123.125.64.abf|2016-03-31|00:00:00| 0.0| 728387.0|0001144204-15-066965|     -index.htm|200.0|  5497.0|1.0|    0.0|    0.0|10.0|    0.0|
|128.118.209.fbd|2016-03-31|00:00:00| 0.0| 706688.0|0001127602-09-003221|           .txt|200.0|  2262.0|0.0|    0.0|    0.0|10.0|    0.0|
|128.118.209.fbd|2016-03-31|00:00:00| 0.0| 822416.0|0001127602-09-003229|           .txt|200.0|  2393.0|0.0|    0.0|    0.0|10.0|    0.0|
|128.118.209.fbd|2016-03-31|00:00:00| 0.0| 822416.0|0001127602-09-003231|           .txt|200.0|  2127.0|0.0|    0.0|    0.0|10.0|    0.0|
|128.118.209.fbd|2016-03-31|00:00:00| 0.0|1168054.0|0001127602-09-003224|           .txt|200.0|  2613.0|0.0|    0.0|    0.0|10.0|    0.0|
|128.118.209.fbd|2016-03-31|00:00:00| 0.0| 822416.0|0001127602-09-003230|           .txt|200.0|  2328.0|0.0|    0.0|    0.0|10.0|    0.0|
|128.118.209.fbd|2016-03-31|00:00:00| 0.0|1020062.0|0001127602-09-003228|           .txt|200.0|  3892.0|0.0|    0.0|    0.0|10.0|    0.0|
+---------------+----------+--------+----+---------+--------------------+---------------+-----+--------+---+-------+-------+----+-------+
only showing top 20 rows

*/
val KVPair = weblog_rdd.map(x => (x._6,List(x._1,x._5))).reduceByKey(_++_).sortBy(_._1)
val sortByTime = weblog_rdd.sortBy(_._3)

val uniqueFileExt = weblog_rdd.map{ s =>
     var l = ""
     if(s._7.contains('.')){
     	var L = s._7.split('.')
     	l = L(L.length-1)

     }
     else{
     	l = s._7
     }
     l
     }

val distinctUni = uniqueFileExt.distinct
distinctUni.toDF("Unique File Ext").show(false)
/*
distinctUni: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[826] at distinct at Q3.scala:25
+----------------------------------------+
|Unique File Ext                         |
+----------------------------------------+
|paper                                   |
|x                                       |
|pfe-%20%20%20%20%20%20%2012312015x10kshe|
|pdf                                     |
|xslForm13F_X01/Greenlight_13FXML_1231201|
|txt                                     |
|fil                                     |
|js                                      |
|xml                                     |
|htm?URL=http%                           |
|css                                     |
|sgml                                    |
|xm                                      |
|htm?utm_campaign=Feed%3A+lo             |
|xls                                     |
|htm                                     |
|xlsx                                    |
|html                                    |
|zip                                     |
|xsd                                     |
+----------------------------------------+
*/
val distinctUniFileExt_number = distinctUni.count
//distinctUniFileExt_number: Long = 20

val RejectedXML = weblog_rdd.map{l =>
     if(l._7.contains(".xml") && l._8 == "404.0"){
     1 }
     else{ 0 }
     }.reduce(_+_)
//RejectedXML: Int = 273

val numDenials = weblog_rdd.map{l =>
     if(l._8 == "404.0"){
     1 }
     else{ 0 }
     }.reduce(_+_)
//numDenials: Int = 502

val SortBasedFiles = weblog_rdd.map{x =>
	var c = ""
	if(x._7.contains('.')){
       var C = x._7.split('.')
       c = C(C.length-1)
      }
    else{
    	c = x._7
    }
    (x._1,x._2,x._3,x._4,x._5,x._6,c,x._8,x._9,x._10,x._11,x._12,x._13,x._14)
 }.sortBy(_._7)

SortBasedFiles.toDF("ip", "date", "time", "zone", "cik", "accession", "extention", "code", "size", "idx", "norefer", "noagent", "find", "crawler").show()
/*
SortBasedFiles: org.apache.spark.rdd.RDD[(String, String, String, String, String, String, String, String, String, String, String, String, String, String)] = MapPartitionsRDD[837] at sortBy at Q3.scala:35
+---------------+----------+--------+----+---------+--------------------+---------+-----+--------+---+-------+-------+----+-------+
|             ip|      date|    time|zone|      cik|           accession|extention| code|    size|idx|norefer|noagent|find|crawler|
+---------------+----------+--------+----+---------+--------------------+---------+-----+--------+---+-------+-------+----+-------+
| 172.243.23.ddh|2016-03-31|00:02:06| 0.0|  63276.0|0001193125-15-062193|      css|304.0|   251.0|0.0|    0.0|    0.0|10.0|    0.0|
|205.154.244.hce|2016-03-31|00:02:12| 0.0| 310158.0|0000310158-14-000071|      css|200.0|  1268.0|0.0|    0.0|    0.0| 7.0|    0.0|
| 172.243.23.ddh|2016-03-31|00:02:39| 0.0|  63276.0|0001193125-15-062193|      css|304.0|   251.0|0.0|    0.0|    0.0|10.0|    0.0|
| 123.125.71.iei|2016-03-31|00:01:01| 0.0| 798523.0|0000798523-03-000003|      fil|200.0|  4503.0|0.0|    0.0|    0.0|10.0|    0.0|
|   72.5.155.gbi|2016-03-31|00:01:57| 0.0|1100663.0|0000897436-16-000692|      fil|304.0|   286.0|0.0|    0.0|    0.0| 9.0|    0.0|
|  66.249.66.ahd|2016-03-31|00:02:03| 0.0|1018953.0|0001018953-10-000004|      fil|200.0|  3525.0|0.0|    0.0|    0.0|10.0|    0.0|
| 68.180.229.dea|2016-03-31|00:02:25| 0.0|1223026.0|0001003715-14-000314|      fil|200.0|  4937.0|0.0|    0.0|    0.0|10.0|    0.0|
|144.203.129.hji|2016-03-31|00:02:35| 0.0| 914036.0|0000940400-16-000982|      fil|200.0| 84126.0|0.0|    0.0|    0.0| 9.0|    0.0|
|  180.76.15.jcd|2016-03-31|00:02:40| 0.0|1159040.0|0000930413-03-000667|      fil|200.0|  2755.0|0.0|    0.0|    0.0|10.0|    0.0|
| 68.180.229.dea|2016-03-31|00:03:57| 0.0|1003839.0|0001003839-08-000012|      fil|200.0|  2208.0|0.0|    0.0|    0.0|10.0|    0.0|
| 68.180.229.dea|2016-03-31|00:04:12| 0.0|1227073.0|0000907244-04-000141|      fil|200.0|  2995.0|0.0|    0.0|    0.0|10.0|    0.0|
|   187.8.26.hhg|2016-03-31|00:04:15| 0.0|1093062.0|0000940400-11-000058|      fil|200.0|  2469.0|0.0|    0.0|    0.0|10.0|    0.0|
|  101.81.76.dii|2016-03-31|00:00:00| 0.0|1283497.0|0001209191-16-111028|      htm|200.0| 14926.0|1.0|    0.0|    0.0|10.0|    0.0|
| 121.200.54.aah|2016-03-31|00:00:00| 0.0|1372514.0|0001144204-16-091485|      htm|200.0|137569.0|0.0|    0.0|    0.0|10.0|    0.0|
| 123.125.64.abf|2016-03-31|00:00:00| 0.0| 728387.0|0001144204-15-066965|      htm|200.0|  5497.0|1.0|    0.0|    0.0|10.0|    0.0|
|  14.141.30.ged|2016-03-31|00:00:00| 0.0|1082923.0|0001144204-10-039849|      htm|200.0| 32458.0|0.0|    0.0|    0.0|10.0|    0.0|
|  14.141.30.ged|2016-03-31|00:00:00| 0.0|1082923.0|0001144204-10-039849|      htm|200.0|  8046.0|0.0|    0.0|    0.0|10.0|    0.0|
|  141.8.132.cje|2016-03-31|00:00:00| 0.0| 921669.0|0000928475-08-000017|      htm|200.0|  2426.0|1.0|    0.0|    0.0|10.0|    0.0|
|  155.97.73.egd|2016-03-31|00:00:00| 0.0|1244937.0|0000950123-11-014724|      htm|200.0| 13344.0|0.0|    0.0|    0.0|10.0|    0.0|
|  155.97.73.egd|2016-03-31|00:00:00| 0.0|1244937.0|0001193125-11-024152|      htm|200.0|279585.0|0.0|    0.0|    0.0|10.0|    0.0|
+---------------+----------+--------+----+---------+--------------------+---------+-----+--------+---+-------+-------+----+-------+
only showing top 20 rows
*/